from django.shortcuts import render
from django.http import HttpResponse 
from librehatti.catalog.models import PurchaseOrder, PurchasedItem
from librehatti.bills.models import *
from django.contrib.auth.models import User
import useraccounts
from django.db.models import Sum
from librehatti.bills.forms import ConfirmForm

def confirm(request):
    error = False
    form = ConfirmForm()
    if 'quote_item' in request.GET:
        item1 = request.GET['quote_item']
        qty1 = request.GET['quote_qty']
        if not (item1 or qty1):
            error = True
        else:   
            quoted_order = QuotedOrder.objects.filter(pk=1)
            quoted_item = QuotedItem.objects.filter(pk=2).values_list('quote_item__name' ,
		           'quote_item__category__name','quote_item__price','quote_qty' , 'quote_price')
            total = QuotedItem.objects.filter(id=2).aggregate(Sum('price'))
            #obj = PurchaseOrder.objects.get(id=1)
            #obj.save()
            
            value = QuotedItem.objects.filter(quote_item=item1)
            return render(request, 'bills/confform.html', {'quote_item': value.item, 'quote_price': value.price, 'total': total})

    
    
    return render(request,'bills/billing.html', {'error':error,'form':form})   

      


